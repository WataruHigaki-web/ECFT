<h2>カート内一覧</h2>

<%=link_to "カートを空にする",users_cart_items_destroy_all_path,class: "btn btn-danger",method: :delete, "data-confirm" => "本当に削除しますか？" %>

<table class="table table-bordered">
  <tr>
    <th>セットまたは商品名</th>
    <th>個数</th>
    <th>金額</th>
    <th></th>
  </tr>
  <% @sum = 0 %>
  <% @cart_items.each do |cart_item| %>
  <tr>
    <% if cart_item.combo.id == 1 %>
      <td>
        <%= link_to users_product_path(cart_item) do %>
          <%= cart_item.product.name %>
        <% end %>
      </td>
    <% else %>
      <td>
        <%= link_to users_combo_items_path(cart_item) do %>
          <%= cart_item.combo.name %>
        <% end %>
      </td>
    <% end %>

    <%= form_with model: cart_item,url:users_cart_item_path(cart_item) do |f| %>
      <td>
        <%= f.number_field :quantity %>
        <%= f.submit "更新",class: "btn btn-info" %>
      </td>
      <td><%= (cart_item.combo.price).to_i * (cart_item.quantity).to_i %></td>
      <td>
        <%= link_to '削除',users_cart_item_path(cart_item),method: :delete,class: "btn btn-danger" %>
      </td>
    <% end %>
  </tr>

  <% @sum += (cart_item.combo.price).to_i * (cart_item.quantity).to_i %>
  <% end %>
</table>

<h4>料金見積もり表（レンタル日数を記入）</h4>

<table class="table table-bordered">
  <tr>
    <th>合計金額/1日</th>
    <td><%= @sum  %>  円</td>
  </tr>
　
  <tr>
    <th>レンタル日数</th>
    <td>
    <%= form_with model:@cart_items,url:users_cart_item_path(@cart_items) do |f| %>
      <%= f.select :day,[1,2,3,4,5,6,7,8,9,10] %>日間
     <% end %>

     <script type="text/javascript">
       document.getElementById("day").onchange;
       console.log("day");
     </script>
    </td>
  </tr>
<!--   <tr>
    <th>ボーナス金額計</th>
    <% if current_user.cart_items.count > 2 %>
      <td class="discount">1000</td>
    <% elsif current_user.cart_items.count > 4 %>
      <td class="discount">2000</td>
    <% end %>
  </tr> -->
　
<!--   <tr>
    <th>最終支払金額</th>
    <td>
      <%= @sum %>円
    </td>
  </tr> -->
</table>

<% if user_signed_in? %>
 <%= link_to '購入手続きへ進む',new_users_order_path(current_user),class: "btn btn-primary" %>
<% else %>
 <%= link_to 'ユーザー登録して注文する',new_user_registration_path,class: "btn btn-primary" %>
<% end %>

<%= link_to '商品一覧に戻る',users_combo_items_path,class: "btn btn-primary" %>